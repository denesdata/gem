<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map Panel</title>
  <link rel="stylesheet" href="base.css">
  <script src="color-scheme.js"></script>
  <style>
    .map-container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .map-svg {
      width: 80%;
      max-width: 400px;
      height: auto;
      opacity: 0.8;
    }
    
    .region {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .region:hover {
      filter: brightness(1.2);
      transform-origin: center;
    }
    
    .map-legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .legend-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }
    
    .legend-color {
      width: 16px;
      height: 12px;
      border-radius: 2px;
    }
    
    .map-title {
      position: absolute;
      top: 16px;
      left: 16px;
    }
    
    .map-value {
      position: absolute;
      top: 16px;
      right: 16px;
      text-align: right;
    }
    
    .map-value-number {
      font-size: 28px;
      font-weight: 700;
      font-family: var(--font-mono);
      color: var(--primary);
    }
    
    .map-value-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Animated gradient background */
    .map-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(from 0deg at 50% 50%, 
        transparent 0deg, 
        var(--primary-glow) 60deg, 
        transparent 120deg);
      animation: rotate 20s linear infinite;
      opacity: 0.3;
    }
    
    @keyframes rotate {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="map-container">
    <div class="map-title">
      <div class="panel-title" id="title">Regional Data</div>
      <div class="panel-subtitle" id="subtitle">Romania NUTS-2 Regions</div>
    </div>
    
    <div class="map-value">
      <div class="map-value-number" id="value">10.8%</div>
      <div class="map-value-label" id="valueLabel">TEA National Average</div>
    </div>
    
    <!-- Simplified Romania regions SVG -->
    <svg class="map-svg" viewBox="0 0 400 300" id="map">
      <!-- Regions will be generated by script -->
    </svg>
    
    <div class="map-legend" id="legend"></div>
  </div>

  <script>
    // Romania regions (simplified representation)
    const regions = [
      { id: 'NW', name: 'Nord-Vest', value: 11.2, path: 'M50,50 L150,40 L160,100 L60,110 Z' },
      { id: 'C', name: 'Centru', value: 9.8, path: 'M160,100 L260,90 L270,160 L170,170 Z' },
      { id: 'NE', name: 'Nord-Est', value: 8.5, path: 'M270,40 L370,50 L360,120 L260,90 Z' },
      { id: 'SE', name: 'Sud-Est', value: 7.2, path: 'M270,160 L370,150 L360,230 L270,240 Z' },
      { id: 'S', name: 'Sud-Muntenia', value: 10.5, path: 'M150,180 L270,160 L270,240 L140,250 Z' },
      { id: 'SW', name: 'Sud-Vest', value: 6.8, path: 'M40,170 L150,180 L140,250 L30,240 Z' },
      { id: 'W', name: 'Vest', value: 12.1, path: 'M30,100 L60,110 L50,180 L40,170 Z' },
      { id: 'BI', name: 'BucureÈ™ti-Ilfov', value: 15.3, path: 'M200,200 L230,195 L235,225 L205,230 Z' },
    ];

    function render() {
      const colors = window.getGemColors ? window.getGemColors() : ['#3D8B70', '#4A9F31', '#5FA832', '#7EC844', '#9AD864', '#BBF7D0'];
      const primary = window.getPrimaryColor ? window.getPrimaryColor() : '#7EC844';
      const mapSvg = document.getElementById('map');
      const legendContainer = document.getElementById('legend');
      const valueEl = document.getElementById('value');
      
      // Update value color
      if (valueEl) valueEl.style.color = primary;
      
      // Calculate color scale
      const values = regions.map(r => r.value);
      const minVal = Math.min(...values);
      const maxVal = Math.max(...values);
      
      // Generate region paths - use colors in order based on value ranking
      const sortedRegions = [...regions].sort((a, b) => a.value - b.value);
      const colorMap = {};
      sortedRegions.forEach((r, i) => {
        colorMap[r.id] = colors[Math.floor((i / (regions.length - 1)) * (colors.length - 1))];
      });
      
      mapSvg.innerHTML = regions.map((region) => {
        return `
          <path 
            class="region" 
            d="${region.path}" 
            fill="${colorMap[region.id]}"
            stroke="var(--bg-card)"
            stroke-width="2"
            data-region="${region.id}"
            data-value="${region.value}"
          >
            <title>${region.name}: ${region.value}%</title>
          </path>
        `;
      }).join('');
      
      // Generate legend
      const legendItems = [
        { label: 'High (>12%)', colorIndex: colors.length - 1 },
        { label: 'Medium', colorIndex: Math.floor(colors.length / 2) },
        { label: 'Low (<8%)', colorIndex: 0 }
      ];
      
      legendContainer.innerHTML = legendItems.map((item) => `
        <div class="legend-row">
          <div class="legend-color" style="background: ${colors[item.colorIndex]}"></div>
          <span>${item.label}</span>
        </div>
      `).join('');
    }

    // Wait for color-scheme.js to initialize
    function init() {
      if (window.GEM && window.getGemColors) {
        render();
      } else {
        setTimeout(init, 50);
      }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
    
    window.addEventListener('gem-settings-change', render);
  </script>
</body>
</html>
